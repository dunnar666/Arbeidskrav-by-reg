---
title: "4. Pendling mellom de ulike kommunene i regionen."
subtitle: "MSB 106 - Anvendt By- og Regionaløkonomi"
output: html_notebook
---

```{r setup}
suppressPackageStartupMessages({
library(tidyverse)
library(lubridate)
library(PxWebApiData)
library(readr)
})
#knitr::opts_chunk$set(eval=FALSE)
```


# Tabell for år 2000

```{r}
Tabell_03321_00 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2000"
  )
```

```{r}
names(Tabell_03321_00)[[1]] <- "desc"
```

```{r}
Tabell_03321_00 <- Tabell_03321_00$dataset %>% 
  mutate(
    NavnArbstedKomm = Tabell_03321_00$desc$arbeidsstedskommune,
    NavnBokommuen = Tabell_03321_00$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tabell_03321_00_Test <- Tabell_03321_00 %>% 
  # Pedantisk
  rename(Bokommune = Bokommuen) %>% 
  # Kan ikke ha med navnene
  select(-Bokommune) %>% 
  # Lager variablene
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted, 4),
         # Setter på navnene igjen
         Bokommune = Tabell_03321_00$Bokommuen
                    ) %>% 
  # Flytter Bokommune lengst til venstre
  select(Bokommune, everything())
```





# Tabell for år 2001

```{r}
Tabell_03321_01 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2001"
  )
```

```{r}
names(Tabell_03321_01)[[1]] <- "desc"
```

```{r}
Tabell_03321_01 <- Tabell_03321_01$dataset %>% 
  mutate(
    NavnArbstedKomm = Tabell_03321_01$desc$arbeidsstedskommune,
    NavnBokommuen = Tabell_03321_01$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```


# Tabell for år 2002


```{r, echo = FALSE}
#siste
```


