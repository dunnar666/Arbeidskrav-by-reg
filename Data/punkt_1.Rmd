---
title: "R Notebook"
output: html_notebook
---

```{r}
knitr::opts_chunk$set(eval=FALSE)
```


```{r}
suppressPackageStartupMessages({
library(PxWebApiData)
library(tidyverse)
library(lubridate)
})
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
```

# Sysselsatte personer etter arbeidssted

```{r}
Tabell1_raw <- ApiData(
  urlToData= "07984",
  Region = list("vs:KommunerS", c(
    "1106",
    "1135",
    "1145",
    "1146",
    "1149",
    "1151",
    "1160",
    "4611",
    "4612",
    "4613",
    "4614",
    "4615",
    "4616",
    "4617",
    "4618",
    "1211",
    "1216",
    "1219",
    "1221",
    "1222",
    "1223",
    "1224",
    "1228",
    "1231")), 
  NACE2007 = TRUE,
  Kjonn = "0",
  ContentsCode = "SysselsatteArb",
  Tid = c(as.character(2008:2020))
  )
```

## Kommentarer fra Thibiga 
* Vi har ikke inkludert "Alder", men får det opp som en variabel. 
* "NACE2007" bruke "00" eller TRUE
* SSB - vi valgte "År", men ble ikke med på JSON-spørringen. Hva skjer hvis vi bruker tekststreng as.character().
* HAr nå inkludert variablen "Tid"

```{r}
Tabell1 <- Tabell1_raw$dataset %>% 
  tibble() %>% 
  rename(
    Knr = Region, 
    Naering = NACE2007,
    Aar = Tid
  )
```
## Thibiga
* Får en feilmelding når jeg prøver å rename. Feilmeldingen forsvant når jeg nytt navn til datasettet. 

```{r}
head(Tabell1)
```
## THIBIGA
* Hva gjør denne chunken? Trenger vi den?

```{r}
names(Tabell1_raw)[[1]]<-"desc"
```
## THIBIGA
* hentet fra arbeidskrav 4 "Vi skal også hente ut det offisielle kommunenavn fra det første elementet i pm2_raw. For å slippe å hanske
med det uhåndterlig lange navnet på dette elementet skifter vi først navn på dette til “desc”."
* Trenger vi denne?

```{r}
Tabell1 <- Tabell1 %>% 
  mutate(knavn = Tabell1$desc$region)
```
## THIBIGA
* Får advarsel når jeg kjører chunken. 

```{r}
Tabell1 <- Tabell1 %>%
  select(-NAstatus)
```
## THIBIGA
Nå gikk det an å fjerne NAstatus.
* Trenger ikke denne variabelen siden den ikke inneholder noe verdier.

```{r}
Tabell1 <- Tabell1 %>% 
  pivot_wider(
    names_from = Naering,
    values_from = value)
```
## THIBIGA
* Hva mangler vi?? 


```{r}
names(Tabell1)[[6]] <- "Alle naeringer"
names(Tabell1)[[7]] <- "Jordbruk, skogbruk og fiske"
names(Tabell1)[[8]] <- "Bergverksdrift og utvinning"
names(Tabell1)[[9]] <- "Industri"
names(Tabell1)[[10]] <- "Elektrisitet, vann og renevasjon"
names(Tabell1)[[11]] <- "Bygge- og anleggsvirksomhet"
names(Tabell1)[[12]] <- "Varehandel, reparasjon av motorvogner"
names(Tabell1)[[13]] <- "Transport og lagring"
names(Tabell1)[[14]] <- "Overnattings- og serveringsvriksomhet"
names(Tabell1)[[15]] <- "Informasjon og kommunikasjon"
names(Tabell1)[[16]] <- "Finansiering og forsikring "
names(Tabell1)[[17]] <- "Teknisk tjenesteyting, eiendosmdrift"
names(Tabell1)[[18]] <- "Forretningsmessig tjenesteyting"
names(Tabell1)[[19]] <- "Off.adm., forsvar, sosialforsikring"
names(Tabell1)[[20]] <- "Undervisning"
names(Tabell1)[[21]] <- "Helse- og sosialtjenester"
names(Tabell1)[[22]] <- "Personlig tjenesteyting"
names(Tabell1)[[23]] <- "Uoppgitt"
```
## THIBIGA
* Fikk ikke til å bruke "rename()", bruker heller "names()". 
* Endret navnene på variablene 7-23. Gir bedre oversikt. 

```{r}
Tabell1 <- Tabell1[Tabell1$`Alle naeringer` !=0,]
```
## THIBIGA
* Denne fjerner fjerner radene med verdi 0.
* Nødvendig??

```{r}
Tabell1[1][(Tabell1)[1]=="1211"]<-"4611"
```


```{r}
rm(Tabell1_raw)
```
## Thibiga 
Fjerner "Tabell1_raw" siden vi ikke har bruk for den. 





## Se på dette senere

Tabell_03321_00 <- Tabell_03321_00$dataset %>% 
  mutate(
    NavnArbstedKomm = Tabell_03321_00$desc$arbeidsstedskommune,
    NavnBokommuen = Tabell_03321_00$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
## Fjerner tomme verdier 

## Haugalandet, Sunnhordland inkludert Hardanger

### Haugalandet 

```{r}
Haug <- ApiData(
  url = "07984",
  Region = list("vs:KommunerS", c(
    "1106",
    "1135",
    "1145",
    "1146",
    "1149",
    "1151",
    "1160")), 
  NACE2007 = "00",
  Kjonn = "0",
  ContentsCode = "SysselsatteArb"
)
```

## Endre navn 

```{r}
Tabell1 <- Tabell1$dataset %>% 
  rename(
    Haugesund = 1106,
    Sauda = 1135,
    Bokn = 1145,
    Tysvaer = 1146,
    Karmoey = 1149,
    Utsira = 1151,
    Vindafjord = 1160
  )
```
## Sunnhordland inkludert Hardanger


## Endre navn

## skal både beskrive situasjonen slik den er for det siste året dere har data, og for utviklingen over tid. Studer først sysselsettingsutviklingen for ulike næringer i ulike kommuner, og for regionen samlet.






# Sysselsatte personer etter bosted

```{r}

```

