---
title: "R Notebook"
output: html_notebook
---

```{r}
knitr::opts_chunk$set(eval=FALSE)
```


```{r}
suppressPackageStartupMessages({
library(PxWebApiData)
library(tidyverse)
library(lubridate)
})
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
```

# Sysselsatte personer etter arbeidssted

```{r}
Tabell1_raw <- ApiData(
  urlToData= "07984",
  Region = list("vs:KommunerS", c(
    "1106",
    "1135",
    "1145",
    "1146",
    "1149",
    "1151",
    "1160",
    "4611",
    "4612",
    "4613",
    "4614",
    "4615",
    "4616",
    "4617",
    "4618",
    "1211",
    "1216",
    "1219",
    "1221",
    "1222",
    "1223",
    "1224",
    "1228",
    "1231")), 
  NACE2007 = TRUE,
  Kjonn = "0",
  ContentsCode = "SysselsatteArb",
  Tid = c(as.character(2008:2020))
  )
```

## Kommentarer fra Thibiga 
* Vi har ikke inkludert "Alder", men får det opp som en variabel. 
* "NACE2007" bruke "00" eller TRUE
* SSB - vi valgte "År", men ble ikke med på JSON-spørringen. Hva skjer hvis vi bruker tekststreng as.character().
* HAr nå inkludert variablen "Tid"

```{r}
Tabell1 <- Tabell1_raw$dataset %>% 
  tibble() %>% 
  rename(
    Knr = Region, 
    Naering = NACE2007,
    Aar = Tid
  )
```


```{r}
head(Tabell1)
```
## THIBIGA
* Hva gjør denne chunken? Trenger vi den?

```{r}
names(Tabell1_raw)[[1]]<-"desc"
```
## THIBIGA
* hentet fra arbeidskrav 4 "Vi skal også hente ut det offisielle kommunenavn fra det første elementet i pm2_raw. For å slippe å hanske
med det uhåndterlig lange navnet på dette elementet skifter vi først navn på dette til “desc”."
* Trenger vi denne?

```{r}
Tabell1 <- Tabell1 %>% 
  mutate(knavn = Tabell1$desc$region)
```
## THIBIGA
* Får advarsel når jeg kjører chunken. 

```{r}
Tabell1 <- Tabell1 %>%
  select(-NAstatus)
```


```{r}
Tabell1 <- Tabell1 %>% 
  pivot_wider(
    names_from = Naering,
    values_from = value)
```

## Ingrid - blir denne pivot-wideren rett?

```{r}
names(Tabell1)[[6]] <- "Alle naeringer"
names(Tabell1)[[7]] <- "Jordbruk, skogbruk og fiske"
names(Tabell1)[[8]] <- "Bergverksdrift og utvinning"
names(Tabell1)[[9]] <- "Industri"
names(Tabell1)[[10]] <- "Elektrisitet, vann og renevasjon"
names(Tabell1)[[11]] <- "Bygge- og anleggsvirksomhet"
names(Tabell1)[[12]] <- "Varehandel, reparasjon av motorvogner"
names(Tabell1)[[13]] <- "Transport og lagring"
names(Tabell1)[[14]] <- "Overnattings- og serveringsvriksomhet"
names(Tabell1)[[15]] <- "Informasjon og kommunikasjon"
names(Tabell1)[[16]] <- "Finansiering og forsikring "
names(Tabell1)[[17]] <- "Teknisk tjenesteyting, eiendosmdrift"
names(Tabell1)[[18]] <- "Forretningsmessig tjenesteyting"
names(Tabell1)[[19]] <- "Off.adm., forsvar, sosialforsikring"
names(Tabell1)[[20]] <- "Undervisning"
names(Tabell1)[[21]] <- "Helse- og sosialtjenester"
names(Tabell1)[[22]] <- "Personlig tjenesteyting"
names(Tabell1)[[23]] <- "Uoppgitt"
```


```{r}
Tabell1 <- Tabell1[Tabell1$`Alle naeringer` !=0,]
```
## THIBIGA
* Denne fjerner fjerner radene med verdi 0.
* Nødvendig??

```{r}
Tabell1[1][(Tabell1)[1]=="1211"]<-"4611"
Tabell1[1][(Tabell1)[1]=="1216"]<-"4612"
Tabell1[1][(Tabell1)[1]=="1219"]<-"4613"
Tabell1[1][(Tabell1)[1]=="1221"]<-"4614"
Tabell1[1][(Tabell1)[1]=="1222"]<-"4615"
Tabell1[1][(Tabell1)[1]=="1223"]<-"4616"
Tabell1[1][(Tabell1)[1]=="1224"]<-"4617"
Tabell1[1][(Tabell1)[1]=="1231"]<-"4618"
```

## INGRID - er siste rett "1228+1231"?

```{r}
rm(Tabell1_raw)
```

## Haugalandet, Sunnhordland inkludert Hardanger

### Haugalandet 

```{r}
Haug_raw <- ApiData(
  url = "07984",
  Region = list("vs:KommunerS", c(
    "1106",
    "1135",
    "1145",
    "1146",
    "1149",
    "1151",
    "1160")), 
  NACE2007 = TRUE,
  Kjonn = "0",
  ContentsCode = "SysselsatteArb",
  Tid = c(as.character(2008:2020))
)
```

## Endre navn 

```{r}
Haug <- Haug_raw$dataset %>% 
  tibble() %>% 
  rename(
    Knr = Region, 
    Naering = NACE2007,
    Aar = Tid
  )
```

```{r}
names(Haug_raw)[[1]]<-"desc1"
```

```{r}
Haug <- Haug %>% 
  mutate(knavn = Sunn$desc2$region)
```

```{r}
Haug <- Haug %>%
  select(-NAstatus)
```


```{r}
Haug <- Haug %>% 
  pivot_wider(
    names_from = Naering,
    values_from = value)
```

```{r}
rm(Haug_raw)
```


## Sunnhordland inkludert Hardanger

```{r}
Sunn_raw <- ApiData(
  url = "07984",
  Region = list("vs:KommunerS", c(
    "4611",
    "4612",
    "4613",
    "4614",
    "4615",
    "4616",
    "4617",
    "4618")), 
  NACE2007 = TRUE,
  Kjonn = "0",
  ContentsCode = "SysselsatteArb",
  Tid = c(as.character(2008:2020))
)
```

## Endre navn 

```{r}
Sunn <- Sunn_raw$dataset %>% 
  tibble() %>% 
  rename(
    Knr = Region, 
    Naering = NACE2007,
    Aar = Tid
  )
```

```{r}
names(Sunn_raw)[[1]]<-"desc2"
```

```{r}
Sunn <- Sunn %>% 
  mutate(knavn = Sunn$desc2$region)
```

```{r}
Sunn <- Sunn %>%
  select(-NAstatus)
```


```{r}
Sunn <- Sunn %>% 
  pivot_wider(
    names_from = Naering,
    values_from = value)
```

```{r}
rm(Sunn_raw)
```


## Endre navn

## skal både beskrive situasjonen slik den er for det siste året dere har data, og for utviklingen over tid. Studer først sysselsettingsutviklingen for ulike næringer i ulike kommuner, og for regionen samlet.

# Sysselsatte personer etter bosted

```{r}

```

